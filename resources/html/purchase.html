<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>

  <!-- Import -->
  <link rel="stylesheet2" type="text/css" href="/css/custom.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v6.2.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <meta property="og:title" content="Neonite" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="index.html" />
  <meta property="og:image" content="https://preview.daneric.dev/neonite/images/LogoTransparent.png" />
  <meta property="og:description" content="Made by kemo (@xkem0x on twitter)" />
  <meta name="theme-color" content="#a74fff">
  <link rel="shortcut icon" href="/Neonite2.png" />
  <meta charset="utf-8">
  <title>Home - Neonite</title>
</head>

<body onload="typeWriter()">
  <div class="container">
    <div class="tommy">
      <main>
        <div class="intro">
          <h1 class="intro-header"><img class="neonite-header" src="/neonite.png" />
          </h1>
          <h2>
            <a id='title' class="intro-description">Thanks for using neonite!</a>
            <br><br><br>

            <h1 id='message'>Press the button below to claim your items.</h1>
            <br><br><br>
            <button id="continue-btn" class="btn btn-white" style="width:25%;">
              <i class="fa-cart-circle-arrow-down"></i></i> ACQUIRE</button>
          </h2>
        </div>
    </div>
    </br>
    </br>
    <div class="text-center">
    </div>
    </br>
    </br>
    </br>
    </br>
    </br>
    </br>
    </br>

    <div class="container second-main">
      <main>
        <h1copy class="copyright-text cuba" style="text-align: center;">This project is not Affiliated, Associated,
          Authorized, Endorsed by, or in
          any way officially connected with EpicGames </a> <br><br> Made with ❤️ by <a class="credits"
            href="https://twitter.com/TheBeatYT_evil">Beat YT</a> | Website made by <a class="credits"
            href="https://daneric.dev/">Daneric</a> and modified by Beat YT</h1copy>
      </main>
    </div>
</body>

<script>
  try {
    function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    const discordMessage = `\nPlease report this in <a href="https://dsc.gg/neonite">our discord</a>`

    // Hey, its not easy to write JS in an HTML tag. can't even use return.
    if (!self.ue) {
      document.getElementById("title").innerText = `Uh oh, missing fortnite functions`;
      document.getElementById("message").innerHTML = 'Missing self.ue' + discordMessage;
      throw "Missing self.ue";
    }
    const purchaseFlow = self.ue.purchaseflow || self.ue.PurchaseFlow || self.ue.purchaseFlow;

    if (!purchaseFlow) {
      document.getElementById("title").innerText = `Whoops, missing fortnite functions`;
      document.getElementById("message").innerHTML = `Missing self.ue.purchaseflow (ue: ${JSON.stringify(self.ue)})` + discordMessage
      throw "Missing purchaseFlow";
    }
    else if (!purchaseFlow.receipt) {
      document.getElementById("title").innerText = `Whoops, missing fortnite functions`;
      document.getElementById("message").innerHTML = 'Missing purchaseflow.receipt' + discordMessage;
      throw "Missing purchaseflow.receipt";
    } else if (!purchaseFlow.requestclose) {
      document.getElementById("title").innerText = `Whoops, missing fortnite functions`;
      document.getElementById("message").innerHTML = 'Missing purchaseflow.requestclose' + discordMessage;
      throw "Missing purchaseflow.requestclose";
    }

    // http://127.0.0.1/purchase?namespace=fn&offers=ede05b3c97e9475a8d9be91da65750f0&analyticsSessionId=%7B4A5577BA-418A-E4A5-D1DC-4D94A34C8D3B%7D

    const params = (new URL(document.location.toString())).search;
    const searchParams = new URLSearchParams(params);

    const offers = searchParams.get('offers').split(',')

    /*const accountId = getCookie('x-neonite-accountId');
    const s_encoded_offers = getCookie('x-neonite-offers');
    const offers = s_encoded_offers ? JSON.parse(decodeURIComponent(s_encoded_offers)) : undefined
    const purchaseToken = getCookie('x-neonite-purchaseToken');

    if (!offers) {
      document.getElementById("title").innerText = `Whoops`;
      document.getElementById("message").innerHTML = 'Missing x-neonite-offers' + discordMessage;

      throw "Missing x-neonite-offers";
    } else if (!accountId) {
      document.getElementById("title").innerText = `Whoops`;
      document.getElementById("message").innerHTML = 'Missing x-neonite-accountId' + discordMessage;
      throw "Missing Missing x-neonite-accountId";
    } else if (!purchaseToken) {
      document.getElementById("title").innerText = `Whoops`;
      document.getElementById("message").innerHTML = 'Missing x-neonite-purchaseToken' + discordMessage;
      throw "Missing Missing x-neonite-purchaseToken";
    }*/

    document.getElementById('continue-btn').addEventListener('click', () => {
      document.getElementById("title").innerText = `Please wait`;
      document.getElementById("message").innerHTML = `Completing purchase...`;
      document.getElementById("continue-btn").style.display = "none";

      try {
        var recipt = {
          "TransactionId": "TransactionId",
          "TransactionState": "Purchased",
          "Offers": offers.map(x => {
            return {
              "OfferNamespace": "fortnite",
              "OfferId": x,
              "Items": [
                {
                  "ItemId": x,
                  "ItemNamespace": "ItemNamespace",
                  "EntitlementId": "EntitlementId",
                  "EntitlementName": "EntitlementName"
                }
              ]
            }
          }),
          "grantedVoucher": {}
        };

        purchaseFlow.receipt(recipt);
        purchaseFlow.requestclose();
      } catch (e) {
        document.getElementById("title").innerText = `Whoops. An error occured while trying to complete your purchase.`;
        document.getElementById("message").innerText = e;
        throw e;
      }
    })
  } catch (e) {
    if (typeof e !== 'string') {
      document.getElementById("title").innerText = `Whoops. An unexpected error has occured.`;
      document.getElementById("message").innerText = e;
      throw e;
    }
  }


</script>

</html>